"use strict";(self.webpackChunkfacturapi_docs=self.webpackChunkfacturapi_docs||[]).push([["7486"],{27414:function(e,i,n){n.r(i),n.d(i,{frontMatter:()=>s,toc:()=>r,default:()=>u,metadata:()=>c,assets:()=>d,contentTitle:()=>t});var c=JSON.parse('{"id":"guides/invoices/cancelaciones","title":"Cancelaciones","description":"Esta gu\xeda explica c\xf3mo funciona la cancelaci\xf3n de facturas en Facturapi, qu\xe9 significa cada estado y qu\xe9 debes esperar despu\xe9s de solicitar la cancelaci\xf3n.","source":"@site/docs/guides/invoices/cancelaciones.mdx","sourceDirName":"guides/invoices","slug":"/guides/invoices/cancelaciones","permalink":"/docs/guides/invoices/cancelaciones","draft":false,"unlisted":false,"editUrl":"https://github.com/facturapi/facturapi-docs/edit/main/website/docs/guides/invoices/cancelaciones.mdx","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"Cancelaciones"},"sidebar":"tutorialSidebar","previous":{"title":"Personalizaci\xf3n de facturas","permalink":"/docs/guides/invoices/customization"},"next":{"title":"Borradores de facturas","permalink":"/docs/guides/drafts"}}'),a=n(74848),l=n(84429);let s={sidebar_position:10,title:"Cancelaciones"},t="Cancelaciones de CFDI",d={},r=[{value:"Requisitos y reglas",id:"requisitos-y-reglas",level:2},{value:"Motivos de cancelaci\xf3n (SAT) y sustituci\xf3n",id:"motivos-de-cancelaci\xf3n-sat-y-sustituci\xf3n",level:2},{value:"Flujo de cancelaci\xf3n y estados",id:"flujo-de-cancelaci\xf3n-y-estados",level:2},{value:"Actualizaci\xf3n autom\xe1tica del estado",id:"actualizaci\xf3n-autom\xe1tica-del-estado",level:2},{value:"Acuse de cancelaci\xf3n y verificaci\xf3n",id:"acuse-de-cancelaci\xf3n-y-verificaci\xf3n",level:2},{value:"Errores comunes",id:"errores-comunes",level:2}];function o(e){let i={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.header,{children:(0,a.jsx)(i.h1,{id:"cancelaciones-de-cfdi",children:"Cancelaciones de CFDI"})}),"\n",(0,a.jsx)(i.p,{children:"Esta gu\xeda explica c\xf3mo funciona la cancelaci\xf3n de facturas en Facturapi, qu\xe9 significa cada estado y qu\xe9 debes esperar despu\xe9s de solicitar la cancelaci\xf3n."}),"\n",(0,a.jsx)(i.h2,{id:"requisitos-y-reglas",children:"Requisitos y reglas"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:["Solo puedes cancelar facturas con ",(0,a.jsx)(i.code,{children:'status: "valid"'}),"."]}),"\n",(0,a.jsxs)(i.li,{children:["Si la factura est\xe1 en ",(0,a.jsx)(i.code,{children:"draft"}),", el m\xe9todo de cancelar la elimina."]}),"\n",(0,a.jsxs)(i.li,{children:["Si la factura ya est\xe1 ",(0,a.jsx)(i.code,{children:"canceled"})," o tiene una cancelaci\xf3n en curso (",(0,a.jsx)(i.code,{children:'cancellation_status: "pending"'})," o ",(0,a.jsx)(i.code,{children:'"verifying"'}),"), el m\xe9todo regresar\xe1 error."]}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"motivos-de-cancelaci\xf3n-sat-y-sustituci\xf3n",children:"Motivos de cancelaci\xf3n (SAT) y sustituci\xf3n"}),"\n",(0,a.jsxs)(i.p,{children:["El SAT define ",(0,a.jsx)(i.strong,{children:"Motivos de cancelaci\xf3n"})," y Facturapi los expone con el par\xe1metro ",(0,a.jsx)(i.code,{children:"motive"}),". La cancelaci\xf3n usa el ",(0,a.jsx)(i.strong,{children:"nuevo esquema de cancelaci\xf3n del SAT (vigente desde 2022)"}),"."]}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:"01"}),": ",(0,a.jsx)(i.strong,{children:"Comprobante emitido con errores con relaci\xf3n"}),". Requiere ",(0,a.jsx)(i.code,{children:"substitution"})," con el UUID (o ID de Facturapi) de la factura que sustituye a la anterior."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:"02"}),": ",(0,a.jsx)(i.strong,{children:"Comprobante emitido con errores sin relaci\xf3n"}),"."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:"03"}),": ",(0,a.jsx)(i.strong,{children:"No se llev\xf3 a cabo la operaci\xf3n"}),"."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:"04"}),": ",(0,a.jsx)(i.strong,{children:"Operaci\xf3n nominativa relacionada en una factura global"}),"."]}),"\n"]}),"\n",(0,a.jsx)(i.p,{children:"El SAT exige que el motivo sea coherente con el caso de uso; si no, la cancelaci\xf3n puede fallar."}),"\n",(0,a.jsx)(i.p,{children:"Notas:"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:["Si eliges el Motivo ",(0,a.jsx)(i.code,{children:"01"}),", debes enviar ",(0,a.jsx)(i.code,{children:"substitution"})," y esa factura debe existir."]}),"\n",(0,a.jsx)(i.li,{children:"Si el SAT considera que tu CFDI no es cancelable (por su estatus o relaciones), la solicitud ser\xe1 rechazada aunque el Motivo sea v\xe1lido."}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"flujo-de-cancelaci\xf3n-y-estados",children:"Flujo de cancelaci\xf3n y estados"}),"\n",(0,a.jsxs)(i.p,{children:["Despu\xe9s de llamar a ",(0,a.jsx)(i.code,{children:"cancelInvoice"}),", puede ocurrir:"]}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:["Respuesta exitosa con ",(0,a.jsx)(i.code,{children:'status: "canceled"'})," y ",(0,a.jsx)(i.code,{children:'cancellation_status: "accepted"'})," (cancelaci\xf3n finalizada)."]}),"\n",(0,a.jsxs)(i.li,{children:["Respuesta exitosa con ",(0,a.jsx)(i.code,{children:'status: "valid"'})," y ",(0,a.jsx)(i.code,{children:'cancellation_status: "pending"'})," (requiere aceptaci\xf3n del receptor)."]}),"\n",(0,a.jsxs)(i.li,{children:["Respuesta exitosa con ",(0,a.jsx)(i.code,{children:'status: "valid"'})," y ",(0,a.jsx)(i.code,{children:'cancellation_status: "verifying"'})," (el SAT recibi\xf3 la solicitud y la est\xe1 validando)."]}),"\n",(0,a.jsx)(i.li,{children:"Error con la explicaci\xf3n de por qu\xe9 no se pudo cancelar."}),"\n"]}),"\n",(0,a.jsxs)(i.p,{children:["Significado de ",(0,a.jsx)(i.code,{children:"cancellation_status"}),":"]}),"\n",(0,a.jsxs)(i.table,{children:[(0,a.jsx)(i.thead,{children:(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.th,{style:{textAlign:"left"},children:"Estado"}),(0,a.jsx)(i.th,{style:{textAlign:"left"},children:"Significado"}),(0,a.jsx)(i.th,{style:{textAlign:"left"},children:"Qu\xe9 hacer"})]})}),(0,a.jsxs)(i.tbody,{children:[(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{style:{textAlign:"left"},children:(0,a.jsx)(i.code,{children:"none"})}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"No hay solicitud registrada por el SAT."}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"Puedes solicitar la cancelaci\xf3n si aplica."})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{style:{textAlign:"left"},children:(0,a.jsx)(i.code,{children:"verifying"})}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"El SAT recibi\xf3 la solicitud y la est\xe1 validando."}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"Espera la actualizaci\xf3n autom\xe1tica o consulta el invoice."})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{style:{textAlign:"left"},children:(0,a.jsx)(i.code,{children:"pending"})}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"Requiere aceptaci\xf3n del receptor."}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"Espera aceptaci\xf3n/rechazo o expiraci\xf3n."})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{style:{textAlign:"left"},children:(0,a.jsx)(i.code,{children:"accepted"})}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"La cancelaci\xf3n fue aceptada."}),(0,a.jsxs)(i.td,{style:{textAlign:"left"},children:["La factura queda en ",(0,a.jsx)(i.code,{children:'status: "canceled"'}),"."]})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{style:{textAlign:"left"},children:(0,a.jsx)(i.code,{children:"rejected"})}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"La cancelaci\xf3n fue rechazada."}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"Revisa el motivo y vuelve a intentar si aplica."})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{style:{textAlign:"left"},children:(0,a.jsx)(i.code,{children:"expired"})}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"El receptor no respondi\xf3 a tiempo."}),(0,a.jsx)(i.td,{style:{textAlign:"left"},children:"Puedes intentar cancelar de nuevo si aplica."})]})]})]}),"\n",(0,a.jsx)(i.h2,{id:"actualizaci\xf3n-autom\xe1tica-del-estado",children:"Actualizaci\xf3n autom\xe1tica del estado"}),"\n",(0,a.jsxs)(i.p,{children:["Facturapi consulta peri\xf3dicamente el SAT y actualiza ",(0,a.jsx)(i.code,{children:"cancellation_status"}),". Puedes:"]}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:["Consultar la factura con ",(0,a.jsx)(i.a,{href:"/api/#tag/invoice/operation/getInvoice",children:"Obtener Factura"}),"."]}),"\n",(0,a.jsxs)(i.li,{children:["Suscribirte al webhook ",(0,a.jsx)(i.code,{children:"invoice.cancellation_status_updated"})," para recibir cambios cuando el estado deje de estar ",(0,a.jsx)(i.code,{children:"pending"})," o ",(0,a.jsx)(i.code,{children:"verifying"}),"."]}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"acuse-de-cancelaci\xf3n-y-verificaci\xf3n",children:"Acuse de cancelaci\xf3n y verificaci\xf3n"}),"\n",(0,a.jsxs)(i.p,{children:["Cuando la cancelaci\xf3n es aceptada, puedes descargar el acuse en XML o PDF desde el endpoint de ",(0,a.jsx)(i.a,{href:"/api/#tag/invoice/operation/downloadCancellationReceiptXml",children:"Cancellation receipt"}),". Tambi\xe9n puedes validar el CFDI con ",(0,a.jsx)(i.code,{children:"verification_url"}),"."]}),"\n",(0,a.jsx)(i.h2,{id:"errores-comunes",children:"Errores comunes"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:"409 Conflict"}),": la factura no est\xe1 en ",(0,a.jsx)(i.code,{children:"valid"})," o ya tiene una cancelaci\xf3n en curso."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:"400 Bad Request"}),": motivo inv\xe1lido o falta ",(0,a.jsx)(i.code,{children:"substitution"})," cuando el SAT lo requiere."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.code,{children:"404 Not Found"}),": el folio o UUID no existe en el SAT."]}),"\n"]})]})}function u(e={}){let{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,a.jsx)(i,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},84429:function(e,i,n){n.d(i,{R:()=>s,x:()=>t});var c=n(96540);let a={},l=c.createContext(a);function s(e){let i=c.useContext(l);return c.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function t(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),c.createElement(l.Provider,{value:i},e.children)}}}]);